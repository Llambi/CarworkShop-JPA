<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings
        xmlns="http://java.sun.com/xml/ns/persistence/orm"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm http://java.sun.com/xml/ns/persistence/orm_2_0.xsd"
        version="2.0">

    <!-- CLASES MAPEADAS-->

    <!--AVERIA-->
    <package>uo.ri.model</package>
    <entity class="Averia">
        <table name="TAverias">
            <unique-constraint>
                <column-name>FECHA</column-name>
                <column-name>VEHICULO_ID</column-name>
            </unique-constraint>
        </table>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <basic name="fecha">
                <temporal>TIMESTAMP</temporal>
            </basic>
            <basic name="status">
                <enumerated>STRING</enumerated>
            </basic>
            <many-to-one name="vehiculo"/>
            <many-to-one name="mecanico"/>
            <many-to-one name="factura"/>
            <one-to-many name="intervenciones" mapped-by="averia"/>
        </attributes>
        <named-query name="Averia.findByIds">
            <query>select a from Averia a where a.id in (?1)</query>
        </named-query>
        <named-query name="Averia.findNoFacturadasByDni">
            <query>
                select a
                from Averia a
                where a.vehiculo.cliente.dni = ?1
                and a.status = uo.ri.model.types.AveriaStatus.TERMINADA
            </query>
        </named-query>
    </entity>

    <!--BONO-->
    <entity class="Bono">
        <table name="TBonos"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <basic name="codigo">
                <column unique="true"/>
            </basic>
        </attributes>
    </entity>

    <!--CARGO-->
    <entity class="Cargo">
        <table name="TCargos">
            <unique-constraint>
                <column-name>FACTURA_ID</column-name>
                <column-name>MEDIOPAGO_ID</column-name>
            </unique-constraint>
        </table>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <many-to-one name="factura"/>
            <many-to-one name="medioPago"/>
        </attributes>
    </entity>

    <!--CLIENTE-->
    <entity class="Cliente">
        <table name="TClientes"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <basic name="dni">
                <column unique="true"/>
            </basic>
            <one-to-many name="vehiculos" mapped-by="cliente"/>
            <one-to-many name="mediosPago" mapped-by="cliente"/>
        </attributes>
    </entity>

    <!--CONTRATO-->
    <entity class="Contract">
        <table name="TContratos">
            <unique-constraint>
                <column-name>STARTDATE</column-name>
                <column-name>MECANICO_ID</column-name>
            </unique-constraint>
        </table>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <basic name="startDate">
                <temporal>TIMESTAMP</temporal>
            </basic>
            <basic name="endDate">
                <temporal>TIMESTAMP</temporal>
            </basic>
            <basic name="status">
                <enumerated>STRING</enumerated>
            </basic>
            <many-to-one name="mecanico"/>
            <many-to-one name="contractType"/>
            <many-to-one name="contractCategory"/>
            <one-to-many name="payrolls" mapped-by="contract"/>
        </attributes>
    </entity>

    <!--CONTRACT_CATEGORY-->
    <entity class="ContractCategory">
        <table name="TCategoriasContrato"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <basic name="name">
                <column unique="true"/>
            </basic>
            <one-to-many name="contracts" mapped-by="contractCategory"/>
        </attributes>
    </entity>

    <!--CONTRACT_TYPE-->
    <entity class="ContractType">
        <table name="TTiposContrato"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <basic name="name">
                <column unique="true"/>
            </basic>
            <one-to-many name="contracts" mapped-by="contractType"/>
        </attributes>
    </entity>

    <!--FACTURA-->
    <entity class="Factura">
        <table name="TFacturas"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <basic name="numero">
                <column unique="true"/>
            </basic>
            <basic name="fecha">
                <temporal>TIMESTAMP</temporal>
            </basic>
            <basic name="status">
                <enumerated>STRING</enumerated>
            </basic>
            <one-to-many name="cargos" mapped-by="factura"/>
            <one-to-many name="averias" mapped-by="factura"/>
        </attributes>
    </entity>

    <!--INTERVENCION-->
    <entity class="Intervencion">
        <table name="TIntervenciones">
            <unique-constraint>
                <column-name>AVERIA_ID</column-name>
                <column-name>MECANICO_ID</column-name>
            </unique-constraint>
        </table>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <many-to-one name="averia"/>
            <many-to-one name="mecanico"/>
            <one-to-many name="sustituciones" mapped-by="intervencion"/>
        </attributes>
    </entity>

    <!--MECANICO-->
    <entity class="Mecanico">
        <table name="TMecanicos"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <basic name="dni">
                <column unique="true"/>
            </basic>
            <one-to-many name="averias" mapped-by="mecanico"/>
            <one-to-many name="intervenciones" mapped-by="mecanico"/>
            <one-to-many name="contracts" mapped-by="mecanico"/>
        </attributes>
    </entity>

    <!--MEDIO_PAGO-->
    <entity class="MedioPago">
        <table name="TMediosPago"/>
        <inheritance strategy="JOINED"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <many-to-one name="cliente"/>
            <one-to-many name="cargos" mapped-by="medioPago"/>
        </attributes>
    </entity>

    <!--METALICO-->
    <entity class="Metalico">
        <table name="TMetalico">
            <unique-constraint>
                <column-name>CLIENTE_ID</column-name>
            </unique-constraint>
        </table>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
        </attributes>
    </entity>

    <!--NOMINA-->
    <entity class="Payroll">
        <table name="TNominas">
            <unique-constraint>
                <column-name>FECHA</column-name>
                <column-name>CONTRATO_ID</column-name>
            </unique-constraint>
        </table>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <basic name="date">
                <temporal>TIMESTAMP</temporal>
            </basic>
            <many-to-one name="contract"/>
        </attributes>
    </entity>

    <!--REPUESTO-->
    <entity class="Repuesto">
        <table name="TRepuestos"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <basic name="codigo">
                <column unique="true"/>
            </basic>
            <one-to-many name="sustituciones" mapped-by="repuesto"/>
        </attributes>
    </entity>

    <!--SUSTITUCION-->
    <entity class="Sustitucion">
        <table name="TSustituciones"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <many-to-one name="repuesto"/>
            <many-to-one name="intervencion"/>
        </attributes>
    </entity>

    <!--TAJETA_CREDITO-->
    <entity class="TarjetaCredito">
        <table name="TTarjetaCredito"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <basic name="numero">
                <column unique="true"/>
            </basic>
        </attributes>
    </entity>

    <!--TIPO_VEHICULO-->
    <entity class="TipoVehiculo">
        <table name="TTipoVehiculo"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <basic name="nombre">
                <column unique="true"/>
            </basic>
            <one-to-many name="vehiculos" mapped-by="tipoVehiculo"/>
        </attributes>
    </entity>

    <!--VEHICULO-->
    <entity class="Vehiculo">
        <table name="TVehiculos"/>
        <attributes>
            <id name="id">
                <generated-value strategy="IDENTITY"/>
            </id>
            <basic name="matricula">
                <column unique="true"/>
            </basic>
            <basic name="numAverias">
                <column name="num_Averias"/>
            </basic>
            <many-to-one name="cliente"/>
            <many-to-one name="tipoVehiculo"/>
            <one-to-many name="averias" mapped-by="vehiculo"/>
        </attributes>
    </entity>

    <!--ADDRESS-->
    <embeddable class="Address"/>
</entity-mappings>